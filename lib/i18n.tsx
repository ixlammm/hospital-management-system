"use client"

import { sub } from "date-fns"
import { createContext, useContext, useState, type ReactNode } from "react"

// Define available locales
export const locales = ["fr", "en"] as const
export type Locale = (typeof locales)[number]

// Define translation type
export type Translations = {
  [key: string]: string | Translations
}


type RecursiveKey<T> = T extends object
    ? { [K in keyof T]: K extends string ? `${K}` | `${K}.${RecursiveKey<T[K]>}` : never}[keyof T]
    : never;

// Translation dictionaries
export const translations: Record<Locale, Translations> = {
  en: {
    common: {
      dashboard: "Dashboard",
      settings: "Settings",
      language: "Language",
      english: "English",
      french: "French",
      save: "Save",
      cancel: "Cancel",
      search: "Search",
      filter: "Filter",
      export: "Export",
      add: "Add",
      adding: "Adding...",
      edit: "Edit",
      delete: "Delete",
      deleting: "Deleting...",
      view: "View",
      actions: "Actions",
      status: "Status",
      total: "total",
      date: "Date",
      type: "Type",
      doctor: "Doctor",
      patient: "Patient",
      action: "Action",
      selectDoctor: "Select Doctor",
      selectPatient: "Select Patient",
      confirmDelete: "Confirm Delete",
      confirmDeleteMessage: "Are you sure you want to delete this item? This action cannot be undone.",
      details: "Details",
      exam: "Examination",
      subject: "Subject",
      description: "Description",
      amount: "Amount",
      noData: "No data available",
      changePasswordTitle: "Change Password",
      changePasswordDescription: "Please change your password to continue using the system.",
      changePassword: "Change Password",
      changingPassword: "Changing password...",
      password: "Password",
      confirmPassword: "Confirm Password",
    },
    navigation: {
      overview: "Overview",
      patients: "Patients",
      staff: "Staff",
      appointments: "Appointments",
      records: "Medical Records",
      reports: "Reports",
      billing: "Billing",
      settings: "Settings",
      rooms: "Rooms & Beds",
      prescriptions: "Prescriptions",
      samples: "Samples",
      radio: "Radio",
      analysis: "Analysis",
      research: "Research",
      invoice: "Invoice",
    },
    patients: {
      title: "Patients",
      addPatient: "Add Patient",
      patientId: "Patient ID",
      name: "Name",
      age: "Age",
      gender: "Gender",
      contact: "Contact",
      status: "Status",
      lastVisit: "Last Visit",
      doctor: "Doctor",
      active: "Active",
      inactive: "Inactive",
      firstName: "First Name",
      lastName: "Last Name",
      dob: "Date of Birth",
      email: "Email",
      phone: "Phone Number",
      address: "Address",
      city: "City",
      state: "State",
      zipCode: "Zip Code",
      insurance: "Insurance Provider",
      notes: "Medical Notes",
      female: "Female",
      male: "Male",
      other: "Other",
      addNewPatient: "Add New Patient",
      patientInfo: "Enter the patient's information to create a new record.",
      viewDetails: "View details",
      editPatient: "Edit patient",
      medicalHistory: "Medical history",
      scheduleAppointment: "Schedule appointment",
      deletePatient: "Delete patient",
      allStatuses: "All Statuses",
      searchPatients: "Search patients...",
      confirmDelete: "Confirm Delete",
      confirmDeleteMessage: "Are you sure you want to delete this patient? This action cannot be undone.",
      addSuccess: "Patient Added",
      addSuccessMessage: "The patient has been successfully added to the system.",
      addError: "Error",
      addErrorMessage: "There was an error adding the patient. Please try again.",
      deleteSuccess: "Patient Deleted",
      deleteSuccessMessage: "The patient has been successfully deleted from the system.",
      viewingDetails: "Viewing details for",
      editingPatient: "Editing patient",
      viewingMedicalHistory: "Viewing medical history for",
      schedulingAppointment: "Scheduling appointment for",
    },
    staff: {
      title: "Staff",
      addStaff: "Add Staff",
      staffId: "Staff ID",
      name: "Name",
      role: "Role",
      department: "Department",
      status: "Status",
      contact: "Contact",
      joined: "Joined",
      onDuty: "On Duty",
      offDuty: "Off Duty",
      onLeave: "On Leave",
      firstName: "First Name",
      lastName: "Last Name",
      email: "Email",
      phone: "Phone Number",
      address: "Address",
      city: "City",
      state: "State",
      zipCode: "Zip Code",
      qualifications: "Qualifications",
      specialization: "Specialization",
      experience: "Years of Experience",
      notes: "Additional Notes",
      female: "Female",
      male: "Male",
      other: "Other",
      addNewStaff: "Add New Staff Member",
      staffInfo: "Enter the staff member's information to create a new record.",
      viewProfile: "View profile",
      editDetails: "Edit details",
      schedule: "Schedule",
      performance: "Performance",
      deleteStaff: "Delete staff member",
      allDepartments: "All Departments",
      searchStaff: "Search staff...",
      doctor: "Doctor",
      nurse: "Nurse",
      technician: "Technician",
      administrative: "Administrative",
      cardiology: "Cardiology",
      neurology: "Neurology",
      pediatrics: "Pediatrics",
      orthopedics: "Orthopedics",
      emergency: "Emergency",
      surgery: "Surgery",
      icu: "ICU",
      dermatology: "Dermatology",
      confirmDelete: "Confirm Delete",
      confirmDeleteMessage: "Are you sure you want to delete this staff member? This action cannot be undone.",
      addSuccess: "Staff Added",
      addSuccessMessage: "The staff member has been successfully added to the system.",
      deleteSuccess: "Staff Deleted",
      deleteSuccessMessage: "The staff member has been successfully deleted from the system.",
      changeStatus: "Change Status",
      currentStatus: "Current status",
      selectNewStatus: "Select new status",
      availableForWork: "Available for work",
      notCurrentlyWorking: "Not currently working",
      onVacationOrLeave: "On vacation or leave",
      statusUpdateSuccess: "Status Updated",
      statusUpdateSuccessMessage: "The staff member's status has been successfully updated.",
      viewingProfile: "Viewing profile for",
      editingDetails: "Editing details for",
      viewingSchedule: "Viewing schedule for",
    },
    appointments: {
      title: "Appointments",
      manage: "Manage and schedule patient appointments",
      newAppointment: "New Appointment",
      appointmentId: "Appointment ID",
      patientName: "Patient Name",
      patientId: "Patient ID",
      doctorName: "Doctor Name",
      department: "Department",
      date: "Date",
      time: "Time",
      status: "Status",
      type: "Type",
      duration: "Duration",
      notes: "Notes",
      scheduled: "Scheduled",
      completed: "Completed",
      cancelled: "Cancelled",
      checkup: "Check-up",
      consultation: "Consultation",
      followup: "Follow-up",
      emergency: "Emergency",
      procedure: "Procedure",
      surgery: "Surgery",
      scheduleNew: "Schedule New Appointment",
      appointmentInfo: "Enter appointment details to schedule a new patient appointment.",
      calendar: "Calendar",
      upcoming: "Upcoming Appointments",
      selectDate: "Select date",
      previousDay: "Previous day",
      nextDay: "Next day",
      viewDetails: "View details",
      reschedule: "Reschedule",
      cancelAppointment: "Cancel appointment",
      minutes: "minutes",
    },
    rooms: {
      title: "Rooms & Beds",
      addRoom: "Add Room",
      roomNumber: "Room Number",
      type: "Type",
      floor: "Floor",
      beds: "Beds",
      status: "Status",
      currentPatient: "Current Patient",
      available: "Available",
      occupied: "Occupied",
      maintenance: "Maintenance",
      general: "General",
      private: "Private",
      icu: "ICU",
      maternity: "Maternity",
      pediatric: "Pediatric",
      operatingRoom: "Operating Room",
      addNewRoom: "Add New Room",
      roomInfo: "Enter room details to add a new room to the system.",
      equipment: "Equipment",
      notes: "Additional Notes",
      viewDetails: "View details",
      assignPatient: "Assign patient",
      markUnavailable: "Mark as unavailable",
      scheduleMaintenance: "Schedule maintenance",
      allTypes: "All Types",
      searchRooms: "Search rooms...",
      occupancySummary: "Occupancy Summary",
      occupancyStatus: "Current room and bed occupancy status.",
      totalRooms: "Total Rooms",
      roomTypes: "Room Types",
      floorOccupancy: "Floor Occupancy",
    },
    radio: {
      title: "Radio",
      addRadio: "Add Radio",
      addNewRadio: "Add New Radio",
      addNewRadioDescription: "Enter radio details to add a new radio to the system.",
    },
    analysis: {
      title: "Analysis",
      addAnalysis: "Add Analysis",
      addNewAnalysis: "Add New Analysis",
      addNewAnalysisDescription: "Enter analysis details to add a new analysis to the system.",
    },
    research: {
      title: "Research",
      addResearch: "Add Research",
      addNewResearch: "Add New Research",
      addNewResearchDescription: "Enter research details to add a new research to the system.",
    },
    invoice: {
      title: "Invoice",
      addInvoice: "Add Invoice",
      addNewInvoice: "Add New Invoice",
      addNewInvoiceDescription: "Enter invoice details to add a new invoice to the system.",
    },
    settings: {
      title: "Settings",
      general: "General",
      account: "Account",
      notifications: "Notifications",
      security: "Security",
      appearance: "Appearance",
      language: "Language",
      languageSettings: "Language Settings",
      selectLanguage: "Select your preferred language",
      saveChanges: "Save Changes",
      theme: "Theme",
      lightMode: "Light Mode",
      darkMode: "Dark Mode",
      systemDefault: "System Default",
    },
  },
  fr: {
    common: {
      dashboard: "Tableau de bord",
      settings: "Paramètres",
      language: "Langue",
      english: "Anglais",
      french: "Français",
      save: "Enregistrer",
      cancel: "Annuler",
      search: "Rechercher",
      filter: "Filtrer",
      export: "Exporter",
      add: "Ajouter",
      adding: "Ajout en cours...",
      edit: "Modifier",
      delete: "Supprimer",
      view: "Voir",
      actions: "Actions",
      status: "Statut",
      total: "total",
    },
    navigation: {
      overview: "Aperçu",
      patients: "Patients",
      staff: "Personnel",
      appointments: "Rendez-vous",
      records: "Dossiers médicaux",
      reports: "Rapports",
      billing: "Facturation",
      settings: "Paramètres",
      rooms: "Chambres & Lits",
      prescriptions: "Ordonnances",
      samples: "Prélèvements",
      radio: "Radio",
    },
    patients: {
      title: "Patients",
      addPatient: "Ajouter un patient",
      patientId: "ID du patient",
      name: "Nom",
      age: "Âge",
      gender: "Genre",
      contact: "Contact",
      status: "Statut",
      lastVisit: "Dernière visite",
      doctor: "Médecin",
      active: "Actif",
      inactive: "Inactif",
      firstName: "Prénom",
      lastName: "Nom de famille",
      dob: "Date de naissance",
      email: "Email",
      phone: "Numéro de téléphone",
      address: "Adresse",
      city: "Ville",
      state: "État/Province",
      zipCode: "Code postal",
      insurance: "Assurance",
      notes: "Notes médicales",
      female: "Femme",
      male: "Homme",
      other: "Autre",
      addNewPatient: "Ajouter un nouveau patient",
      patientInfo: "Entrez les informations du patient pour créer un nouveau dossier.",
      viewDetails: "Voir les détails",
      editPatient: "Modifier le patient",
      medicalHistory: "Historique médical",
      scheduleAppointment: "Planifier un rendez-vous",
      deletePatient: "Supprimer le patient",
      allStatuses: "Tous les statuts",
      searchPatients: "Rechercher des patients...",
      confirmDelete: "Confirmer la suppression",
      confirmDeleteMessage: "Êtes-vous sûr de vouloir supprimer ce patient ? Cette action ne peut pas être annulée.",
      addSuccess: "Patient ajouté",
      addSuccessMessage: "Le patient a été ajouté avec succès au système.",
      addError: "Erreur",
      addErrorMessage: "Une erreur s'est produite lors de l'ajout du patient. Veuillez réessayer.",
      deleteSuccess: "Patient supprimé",
      deleteSuccessMessage: "Le patient a été supprimé avec succès du système.",
      viewingDetails: "Affichage des détails pour",
      editingPatient: "Modification du patient",
      viewingMedicalHistory: "Consultation de l'historique médical de",
      schedulingAppointment: "Planification d'un rendez-vous pour",
    },
    staff: {
      title: "Personnel",
      addStaff: "Ajouter un membre",
      staffId: "ID du personnel",
      name: "Nom",
      role: "Rôle",
      department: "Département",
      status: "Statut",
      contact: "Contact",
      joined: "Embauché le",
      onDuty: "En service",
      offDuty: "Hors service",
      onLeave: "En congé",
      firstName: "Prénom",
      lastName: "Nom de famille",
      email: "Email",
      phone: "Numéro de téléphone",
      address: "Adresse",
      city: "Ville",
      state: "État/Province",
      zipCode: "Code postal",
      qualifications: "Qualifications",
      specialization: "Spécialisation",
      experience: "Années d'expérience",
      notes: "Notes supplémentaires",
      female: "Femme",
      male: "Homme",
      other: "Autre",
      addNewStaff: "Ajouter un nouveau membre du personnel",
      staffInfo: "Entrez les informations du membre du personnel pour créer un nouveau dossier.",
      viewProfile: "Voir le profil",
      editDetails: "Modifier les détails",
      schedule: "Planning",
      performance: "Performance",
      deleteStaff: "Supprimer le membre du personnel",
      allDepartments: "Tous les départements",
      searchStaff: "Rechercher du personnel...",
      doctor: "Médecin",
      nurse: "Infirmier(ère)",
      technician: "Technicien",
      administrative: "Administratif",
      cardiology: "Cardiologie",
      neurology: "Neurologie",
      pediatrics: "Pédiatrie",
      orthopedics: "Orthopédie",
      emergency: "Urgence",
      surgery: "Chirurgie",
      icu: "Soins intensifs",
      dermatology: "Dermatologie",
      confirmDelete: "Confirmer la suppression",
      confirmDeleteMessage:
        "Êtes-vous sûr de vouloir supprimer ce membre du personnel ? Cette action ne peut pas être annulée.",
      addSuccess: "Personnel ajouté",
      addSuccessMessage: "Le membre du personnel a été ajouté avec succès au système.",
      deleteSuccess: "Personnel supprimé",
      deleteSuccessMessage: "Le membre du personnel a été supprimé avec succès du système.",
      changeStatus: "Changer le statut",
      currentStatus: "Statut actuel",
      selectNewStatus: "Sélectionner un nouveau statut",
      availableForWork: "Disponible pour le travail",
      notCurrentlyWorking: "Actuellement indisponible",
      onVacationOrLeave: "En vacances ou en congé",
      statusUpdateSuccess: "Statut mis à jour",
      statusUpdateSuccessMessage: "Le statut du membre du personnel a été mis à jour avec succès.",
      viewingProfile: "Consultation du profil de",
      editingDetails: "Modification des détails de",
      viewingSchedule: "Consultation du planning de",
    },
    appointments: {
      title: "Rendez-vous",
      manage: "Gérer et planifier les rendez-vous des patients",
      newAppointment: "Nouveau rendez-vous",
      appointmentId: "ID du rendez-vous",
      patientName: "Nom du patient",
      patientId: "ID du patient",
      doctorName: "Nom du médecin",
      department: "Département",
      date: "Date",
      time: "Heure",
      status: "Statut",
      type: "Type",
      duration: "Durée",
      notes: "Notes",
      scheduled: "Planifié",
      completed: "Terminé",
      cancelled: "Annulé",
      checkup: "Contrôle",
      consultation: "Consultation",
      followup: "Suivi",
      emergency: "Urgence",
      procedure: "Procédure",
      surgery: "Chirurgie",
      scheduleNew: "Planifier un nouveau rendez-vous",
      appointmentInfo: "Entrez les détails du rendez-vous pour planifier un nouveau rendez-vous patient.",
      calendar: "Calendrier",
      upcoming: "Rendez-vous à venir",
      selectDate: "Sélectionner une date",
      previousDay: "Jour précédent",
      nextDay: "Jour suivant",
      viewDetails: "Voir les détails",
      reschedule: "Reprogrammer",
      cancelAppointment: "Annuler le rendez-vous",
      minutes: "minutes",
    },
    rooms: {
      title: "Chambres & Lits",
      addRoom: "Ajouter une chambre",
      roomNumber: "Numéro de chambre",
      type: "Type",
      floor: "Étage",
      beds: "Lits",
      status: "Statut",
      currentPatient: "Patient actuel",
      available: "Disponible",
      occupied: "Occupé",
      maintenance: "Maintenance",
      general: "Général",
      private: "Privé",
      icu: "Soins intensifs",
      maternity: "Maternité",
      pediatric: "Pédiatrique",
      operatingRoom: "Salle d'opération",
      addNewRoom: "Ajouter une nouvelle chambre",
      roomInfo: "Entrez les détails de la chambre pour ajouter une nouvelle chambre au système.",
      equipment: "Équipement",
      notes: "Notes supplémentaires",
      viewDetails: "Voir les détails",
      assignPatient: "Assigner un patient",
      markUnavailable: "Marquer comme indisponible",
      scheduleMaintenance: "Planifier une maintenance",
      allTypes: "Tous les types",
      searchRooms: "Rechercher des chambres...",
      occupancySummary: "Résumé d'occupation",
      occupancyStatus: "Statut actuel d'occupation des chambres et des lits.",
      totalRooms: "Total des chambres",
      roomTypes: "Types de chambres",
      floorOccupancy: "Occupation par étage",
    },
    settings: {
      title: "Paramètres",
      general: "Général",
      account: "Compte",
      notifications: "Notifications",
      security: "Sécurité",
      appearance: "Apparence",
      language: "Langue",
      languageSettings: "Paramètres de langue",
      selectLanguage: "Sélectionnez votre langue préférée",
      saveChanges: "Enregistrer les modifications",
      theme: "Thème",
      lightMode: "Mode clair",
      darkMode: "Mode sombre",
      systemDefault: "Défaut système",
    },
  },
}

// Create a context for the i18n
type I18nContextType = {
  locale: Locale
  setLocale: (locale: Locale) => void
  t: (key: RecursiveKey<typeof translations.en>) => string
}

const I18nContext = createContext<I18nContextType | undefined>(undefined)

// Provider component
export function I18nProvider({ children, defaultLocale = "en" }: { children: ReactNode; defaultLocale?: Locale }) {
  const [locale, setLocale] = useState<Locale>(defaultLocale)

  // Translation function
  const t = (key: RecursiveKey<typeof translations.en>): string => {
    const keys = key.split(".")
    let value: any = translations[locale]

    for (const k of keys) {
      if (value === undefined) return key
      value = value[k]
    }

    return typeof value === "string" ? value : key
  }

  return <I18nContext.Provider value={{ locale, setLocale, t }}>{children}</I18nContext.Provider>
}


// Hook to use the i18n context
export function useI18n(): I18nContextType {
  const context = useContext(I18nContext)
  if (context === undefined) {
    // Return a default context instead of throwing an error
    return {
      locale: "en" as Locale,
      setLocale: () => {},
      t: (key: RecursiveKey<typeof translations["en"]>) => key
    }
  }
  return context
}

